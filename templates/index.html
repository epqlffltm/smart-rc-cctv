<!DOCTYPE html>
<html>
<head>
    <title>PiCar-X Web Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <style>
        body { text-align: center; font-family: sans-serif; background: #222; color: white; }
        #video-feed { width: 80%; max-width: 600px; border: 2px solid #555; margin-top: 20px; }
        .controls { display: flex; justify-content: space-around; padding: 20px; }
        #joystick { width: 150px; height: 150px; background: #333; border-radius: 50%; position: relative; }
        .btn { padding: 15px 25px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; background: #444; color: white; }
        .btn-record { background: #d32f2f; }
        .cam-btns button { display: block; margin: 5px; width: 80px; }
    </style>
</head>
<body>
    <h2>PiCar-X Control Panel</h2>
    
    <img id="video-feed" src="http://"+window.location.hostname+":9000/mjpg">

    <div class="controls">
        <div class="cam-btns">
            <button class="btn" onclick="sendCam('up')">Tilt Up</button>
            <button class="btn" onclick="sendCam('down')">Tilt Down</button>
            <button class="btn btn-record" id="recBtn" onclick="toggleRecord()">REC</button>
        </div>

        <div id="joystick"></div>
    </div>

    <script>
        // 조이스틱 설정
        var joystick = nipplejs.create({
            zone: document.getElementById('joystick'),
            mode: 'static',
            position: {left: '50%', top: '50%'},
            color: 'red'
        });

        joystick.on('move', function (evt, data) {
            if (data.distance > 10) {
                let speed = Math.round(data.distance); // 0-50 사이
                let angle = Math.round(data.vector.x * 30); // 조향 각도
                fetch(`/control?dir=move&speed=${speed}&angle=${angle}`);
            }
        });

        joystick.on('end', function () {
            fetch(`/control?dir=stop`);
        });

        function sendCam(cmd) {
            fetch(`/camera?cmd=${cmd}`);
        }

        let recording = false;
        function toggleRecord() {
            recording = !recording;
            const status = recording ? 'start' : 'stop';
            document.getElementById('recBtn').innerText = recording ? 'STOP' : 'REC';
            fetch(`/record?status=${status}`);
        }
    </script>
</body>
</html>